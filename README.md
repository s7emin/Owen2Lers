Скрипт `Owen2Lers` позволяет автоматически получать текущие данные с устройств из OwenCloud, и отправлять их в систему ЛЭРС УЧЕТ.

## Установка и настройка Python

1. Скачайте и установите Python (если он еще не установлен) с официального сайта: [Python.org](https://www.python.org/).
2. Установите библиотеку `requests`:

   ```sh
   pip install requests
   ```
3. [Скачайте](https://github.com/s7emin/Owen2Lers/archive/refs/heads/main.zip) репозиторий себе на ПК в отдельную папку.
## Первоначальная настройка

### Настройка учётных записей

Создайте отдельные учётные записи для работы скрипта в [OwenCloud](https://web.owencloud.ru/) и на сервере ЛЭРС УЧЕТ.

В целях безопасности ограничьте права доступа только требуемыми операциями.

Создайте Bearer токены в каждом из сервисов, далее они понадобятся при настройке.

| OwenCloud | ЛЭРС УЧЕТ |
| ------ | ------ |
| В OwenCloud необходимо снять галочки напротив всех разрешений | В ЛЭРСе необходимо разрешение на импорт данных |
| ![owen_perm](/docs/owen_perm.png) | ![lers_perm](/docs/lers_perm.png) |
| В правом верхнем углу сервиса расположен пункт `Настройки - Токены` | В свойствах учётной записи пункт `Доступ` |
| ![owen_token](/docs/owen_token.png) | ![lers_token](/docs/lers_token.png) |

### Пошаговая настройка подключения

Откройте папку со скачанным репозиторием и запустите скрипт настройки.

*для Windows: [запустите cmd в папке со скриптом](https://www.outsidethebox.ms/10629/) и затем выполните указанную команду:*
```sh
python setup.py
```
Введите требуемые данные
   - Bearer токен для OwenCloud
   - URL сервера ЛЭРС (в виде `http://my.lers.ru:10000`)
   - Bearer токен для ЛЭРС
   - Интервал отправки данных (в секундах).

#### Настройка параметров для передачи данных:
   - Введите ID точки учета ЛЭРС (удобнее всего открыть карточку точки учёта в веб интерфейсе и посмотреть в адресной строке браузера значение после measurepoints/**123**).
   - Введите ID параметра Owen (*TODO: описать порядок получения ID*)
   - Введите [тип ресурса ЛЭРС](https://docs.lers.ru/fw/api/Lers.Data.DataParameter.html) (например `T_in`).
   - **Повторите шаги для всех необходимых параметров**. Для завершения настройки нажмите Enter.
   *Для одной точки учёта ЛЭРС можно указать множество значений ID Owen : Тип ресурса*

После завершения настройки скрипт сохранит конфигурацию в файл `config.json`.

## Пример использования

После завершения настройки вы можете запустить основной скрипт для передачи данных:

```sh
python Owen2Lers.py
```

Скрипт будет автоматически получать данные с устройств OwenCloud и отправлять их в систему ЛЭРС УЧЕТ в соответствии с заданной конфигурацией.
